"object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(a){return 10>a?"0"+a:a}function this_value(){return this.valueOf()}function quote(a){return rx_escapable.lastIndex=0,rx_escapable.test(a)?'"'+a.replace(rx_escapable,function(a){var b=meta[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g,h=gap,i=b[a];switch(i&&"object"==typeof i&&"function"==typeof i.toJSON&&(i=i.toJSON(a)),"function"==typeof rep&&(i=rep.call(b,a,i)),typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";if(gap+=indent,g=[],"[object Array]"===Object.prototype.toString.apply(i)){for(f=i.length,c=0;f>c;c+=1)g[c]=str(c,i)||"null";return e=0===g.length?"[]":gap?"[\n"+gap+g.join(",\n"+gap)+"\n"+h+"]":"["+g.join(",")+"]",gap=h,e}if(rep&&"object"==typeof rep)for(f=rep.length,c=0;f>c;c+=1)"string"==typeof rep[c]&&(d=rep[c],e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));return e=0===g.length?"{}":gap?"{\n"+gap+g.join(",\n"+gap)+"\n"+h+"}":"{"+g.join(",")+"}",gap=h,e}}var rx_one=/^[\],:{}\s]*$/,rx_two=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,rx_three=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,rx_four=/(?:^|:|,)(?:\s*\[)+/g,rx_escapable=/[\\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,rx_dangerous=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},Boolean.prototype.toJSON=this_value,Number.prototype.toJSON=this_value,String.prototype.toJSON=this_value);var gap,indent,meta,rep;"function"!=typeof JSON.stringify&&(meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(a,b,c){var d;if(gap="",indent="","number"==typeof c)for(d=0;c>d;d+=1)indent+=" ";else"string"==typeof c&&(indent=c);if(rep=b,b&&"function"!=typeof b&&("object"!=typeof b||"number"!=typeof b.length))throw new Error("JSON.stringify");return str("",{"":a})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&"object"==typeof e)for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),void 0!==d?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;if(text=String(text),rx_dangerous.lastIndex=0,rx_dangerous.test(text)&&(text=text.replace(rx_dangerous,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),rx_one.test(text.replace(rx_two,"@").replace(rx_three,"]").replace(rx_four,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),function(a){"undefined"==typeof Reasons&&(Reasons={}),Reasons.Builder=Garnish.Base.extend({$container:null,init:function(b){if(this.setSettings(b,Reasons.Builder.defaults),this.templates=this.settings.templates,this.fieldId=this.settings.fieldId,this.$container=a(this.templates.builderUi()),this.$builder=this.$container.find(".reasonsBuilder:first"),this.$rule=this.$container.find(".reasonsRule:first").clone(!0),this.$statement=this.$container.find(".reasonsStatement:first").clone(!0),this.$statement.find(".reasonsRule").remove(),this.$message=this.$container.find(".reasonsMessage:first"),this.$container.on("click",".reasonsAddRule",a.proxy(this.onReasonsAddRuleClick,this)).on("click",".reasonsRemoveRule",a.proxy(this.onReasonsRemoveRuleClick,this)).on("click",".reasonsAddStatement",a.proxy(this.onReasonsAddStatementClick,this)).on("change",".reasonsRuleToggleField select",a.proxy(this.onReasonsRuleToggleFieldChange,this)).on("change",".reasonsRuleCompare select",a.proxy(this.onReasonsRuleCompareChange,this)).on("change",".reasonsRuleValue *:input",a.proxy(this.onReasonsRuleValueChange,this)),this.$builder.html(""),this.setToggleFields(this.settings.toggleFields),this.settings.rules&&this.settings.rules.length>0)for(var c=0;c<this.settings.rules.length;++c)this.addStatement({rules:this.settings.rules[c]});this.refresh(),Reasons.Builder.instances.push(this)},get:function(){return this.$container},disable:function(){this.$container.addClass("disabled")},enable:function(){this.$container.removeClass("disabled")},update:function(a){this.setSettings(a,this.settings),this.setToggleFields(this.settings.toggleFields),this.refresh()},setToggleFields:function(a){this.settings.toggleFields=[],this.settings.toggleFieldIds=[];for(var b=0;b<a.length;++b)parseInt(a[b].id)!==this.fieldId&&(this.settings.toggleFields.push(a[b]),this.settings.toggleFieldIds.push(parseInt(a[b].id)));for(var c="",b=0;b<this.settings.toggleFields.length;++b)c+=this.templates.toggleSelectOption(this.settings.toggleFields[b]);this.$rule.find(".reasonsRuleToggleField select").html(c)},refresh:function(){this.settings.rules=[];var b=this.settings.toggleFields;if(0===b.length)return this.disable(),this.$message.text(Reasons.settings.noToggleFieldsMessage),!1;this.enable(),this.$message.text("");var c,d,e,f,g,h,i=this,j=this.$container.find(".reasonsStatement");j.each(function(){return c=[],d=a(this),e=d.find(".reasonsRule"),e.each(function(){if(f=a(this),g=f.find(".reasonsRuleToggleField select"),toggleSelectValue=parseInt(g.val()),-1===i.settings.toggleFieldIds.indexOf(toggleSelectValue))return void f.remove();h="";for(var d=0;d<i.settings.toggleFields.length;++d)h+=i.templates.toggleSelectOption(b[d],parseInt(b[d].id)===toggleSelectValue);g.html(h),c.push({fieldId:toggleSelectValue,compare:f.find(".reasonsRuleCompare select").val(),value:f.find(".reasonsRuleValue *:input:first").val()})}),0===c.length?void d.remove():void i.settings.rules.push(c)})},getConditionals:function(){return this.settings.rules&&this.settings.rules.length>0?this.settings.rules:!1},addStatement:function(b){b=a.extend({rules:!1},b);var c=this.$statement.clone(!0),d=b.rules;if(this.$builder.append(c),d)for(var e=0;e<d.length;++e)this.addRule(a.extend({target:c},d[e]));else this.addRule({target:c});return c},addRule:function(b){b=a.extend({fieldId:null,compare:null,value:null},b);var c=this.$rule.clone(!0),d=b.target||this.$builder.find(".reasonsStatement:last"),e=b.fieldId,f=b.compare,g=b.value;return e&&c.find(".reasonsRuleToggleField select").val(e),d.length>0?(d.find(".reasonsRules:first").append(c),c.find(".reasonsRuleToggleField select").trigger("change"),f&&c.find(".reasonsRuleCompare select").val(f),g&&c.find(".reasonsRuleValue *:input:first").val(g),c):!1},onReasonsAddRuleClick:function(b){b.preventDefault();var c=a(b.currentTarget).parents(".reasonsStatement");this.addRule({target:c})},onReasonsRemoveRuleClick:function(b){b.preventDefault();var c=a(b.currentTarget),d=c.parents(".reasonsRule");d.remove(),this.refresh()},onReasonsAddStatementClick:function(a){a.preventDefault(),this.addStatement()},onReasonsRuleToggleFieldChange:function(b){b.preventDefault();var c=a(b.currentTarget),d=c.parents(".reasonsRule"),e=d.find(".reasonsRuleValue"),f=c.val(),g=Reasons.getToggleFieldById(f),h=g.type,i=g.settings,j="";switch(h){case"Lightswitch":j=this.templates.select([{"true":Craft.t("on")},{"false":Craft.t("off")}]);break;case"Dropdown":case"MultiSelect":case"Checkboxes":case"RadioButtons":for(var k,l=i.options,m=[],n=0;n<l.length;++n)k={},k[l[n].value]=l[n].label,m.push(k);j=this.templates.select(m);break;case"Number":j=this.templates.number(i);break;case"PositionSelect":for(var k,l=i.options,m=[],n=0;n<l.length;++n)k={},k[l[n]]=l[n].charAt(0).toUpperCase()+l[n].slice(1),m.push(k);j=this.templates.select(m);break;default:j=this.templates.input(i)}e.html(j)},onReasonsRuleCompareChange:function(a){a.preventDefault()},onReasonsRuleValueChange:function(a){a.preventDefault()}},{defaults:{fieldId:null,toggleFields:null,rules:null,templates:{select:function(a){for(var b,c,d,e=[],f=0;f<a.length;++f)b=a[f],c=Object.keys(b)[0],d=b[c],e.push('<option value="'+c+'">'+d+"</option>");return'<div class="select"><select>'+e.join("")+"</select></div>"},toggleSelectOption:function(a,b){return'<option value="'+a.id+'" data-type="'+a.type+'"'+(b?" selected":"")+">"+a.name+"</option>"},number:function(a){return'<div class="input"><input class="text" type="number" value="0" min="'+a.min+'" max="'+a.max+'" autocomplete="off"></div>'},input:function(b){var c="";return b=a.extend({initialRows:4,placeholder:"",multiline:!1},b),c+="1"===b.multiline?'<textarea rows="'+b.initialRows+'" placeholder="'+b.placeholder+'" autocomplete="off"></textarea>':'<input class="text" type="text" size="20" value="" placeholder="'+b.placeholder+'" autocomplete="off">','<div class="input">'+c+"</div>"},builderUi:function(){return'<div class="reasonsBuilderUi"><div class="wrapper"><div class="heading"><span>'+Craft.t("Show this field if")+'</span></div><div class="reasonsBuilder"><div class="reasonsStatement"><span class="delimiter">'+Craft.t("or")+'</span><div class="reasonsRules"><div class="reasonsRule"><div class="reasonsRuleParams"><div class="select reasonsRuleToggleField"><select /></div><div class="select reasonsRuleCompare"><select><option value="==">'+Craft.t("is equal to")+'</option><option value="!=">'+Craft.t("is not equal to")+'</option></select></div><div class="reasonsRuleValue" /></div><div class="reasonsRuleAmend"><a class="delete icon reasonsRemoveRule" title="'+Craft.t("Remove rule")+'"></a><a class="add icon reasonsAddRule" title="'+Craft.t("and")+'"></a></div><span class="reasonsRuleLead">'+Craft.t("and")+'</span></div></div></div></div><div class="reasonsAdd"><a class="btn reasonsAddStatement">'+Craft.t("Add rules")+'</a></div></div><div class="reasonsMessage"></div></div>'}}},instances:[]})}(jQuery),function(a){"undefined"==typeof Reasons&&(Reasons={}),Reasons.EditForm=Garnish.Base.extend({$container:null,init:function(b,c){if(this.setSettings(c,Reasons.EditForm.defaults),this.$container=b,this.elementType,this.sectionId=this.$container.find('input[name="sectionId"]').val(),this.sectionId&&(this.elementType="entries"),this.$entryTypeSelect=a(this.settings.entryTypeSelectSelector),0===this.$entryTypeSelect.length){var d=Reasons.getEntryTypeIdsBySectionId(this.sectionId);this.entryTypeId=d&&d.length>0?d.shift():!1}else this.entryTypeId=this.$entryTypeSelect.val();this.currentUrl=window.location.href,a(document).ajaxComplete(a.proxy(this.onAjaxComplete,this)),this.$container.on("click",this.settings.fieldsSelector+'[data-toggle="1"]',a.proxy(this.onInputWrapperClick,this)).on("change keyup",this.settings.fieldsSelector+'[data-toggle="1"] *:input',a.proxy(this.onFieldInputChange,this)),this.render(),console.log("edit form init. section id:",this.sectionId)},render:function(){this.initToggleFields()&&this.evaluateConditionals()},initToggleFields:function(){var b=Reasons.getConditionalsDataByEntryTypeId(this.entryTypeId);if(!b||b.sectionId!=this.sectionId||b.typeId!=this.entryTypeId||!b.conditionals)return!1;if(this.conditionals=b.conditionals,this.$fieldContainer=a(this.settings.fieldsContainerSelector),this.$fields=this.$fieldContainer.find(this.settings.fieldsSelector),0===this.$fieldContainer.length||0===this.$fields.length)return!1;var c=[];for(g in this.conditionals)for(var d=0;d<this.conditionals[g].length;++d)c.push(this.conditionals[g][d][0].fieldId);var e,f,g,h=this;return this.$fields.each(function(){e=a(this),f=e.attr("id").split("-")[1]||!1,g=Reasons.getFieldIdByHandle(f),g&&e.attr("data-id",g),h.conditionals[g]&&e.attr("data-target",1),c.indexOf(parseInt(g))>-1&&e.attr("data-toggle",1)}),!0},evaluateConditionals:function(b){var c,d,e,f,g,h,i,j,k=this,l=this.$fieldContainer.find(this.settings.fieldsSelector+'[data-target="1"]');l.removeClass("reasonsHide").each(function(){if(c=a(this),d=k.conditionals[c.data("id")]||!1){for(var b=d.length,l=b,m=0;b>m;++m){e=!0,f=d[m];for(var n=0;n<f.length;++n)if(g=f[n],h=k.$fieldContainer.find(k.settings.fieldsSelector+'[data-id="'+g.fieldId+'"]'),0!==h.length&&(i=h.find("*:input:first"),0!==i.length)){switch(j=i.val(),i.parent().hasClass("lightswitch")&&(j="1"===j?"true":"false"),g.compare){case"!=":j==g.value&&(e=!1);break;case"==":default:j!=g.value&&(e=!1)}if(!e){l--;break}}}0>=l&&c.addClass("reasonsHide")}})},onAjaxComplete:function(a,b,c){return-1===c.url.indexOf("switchEntryType")?!1:(this.entryTypeId=this.$entryTypeSelect.val(),void this.render())},onInputWrapperClick:function(b){a(b.currentTarget).find("input:first").trigger("change")},onFieldInputChange:function(a){this.evaluateConditionals()}},{defaults:{fieldsContainerSelector:"#fields",fieldsSelector:".field:not(#title-field)",entryTypeSelectSelector:"#entryType",lightswitchContainerSelector:".lightswitch",positionSelectContainerSelector:".btngroup"}})}(jQuery),function(a){"undefined"==typeof Reasons&&(Reasons={}),Reasons.FieldLayoutConditionalDesigner=Garnish.Base.extend({$container:null,toggleFieldIds:[],init:function(b,c){if(this.setSettings(c,Reasons.FieldLayoutConditionalDesigner.defaults),this.$container=b,this.$form=this.$container.parents(this.settings.formSelector),0===this.$form.length)return!1;this.templates=this.settings.templates,this.$conditionalsInput=a(this.templates.input({name:"_reasons",type:"hidden"})),this.$conditionalsIdInput=a(this.templates.input({name:"_reasonsId",value:this.settings.id,type:"hidden"})),this.$form.append(this.$conditionalsInput).append(this.$conditionalsIdInput).on("submit",a.proxy(this.onFormSubmit,this));var d=this;a.map(Reasons.getToggleFields(),function(a){d.toggleFieldIds.push(parseInt(a.id))}),setTimeout(a.proxy(this.refresh,this),0),this.$container.on("mousedown",this.settings.fieldSelector,a.proxy(this.onFieldMouseDown,this))},refresh:function(){var b,c,d,e,f=this,g={};this.$container.find(this.settings.tabSelector).each(function(){b=a(this).find(f.settings.fieldSelector),e=[],b.each(function(){if(c=a(this),d=parseInt(c.data("id")),f.toggleFieldIds.indexOf(d)>-1){var b=Reasons.getToggleFieldById(d);b&&e.push(b)}}),b.each(function(){c=a(this),d=parseInt(c.data("id")),c.data("_reasonsBuilder")?c.data("_reasonsBuilder").update({toggleFields:e}):c.data("_reasonsBuilder",new Reasons.Builder({fieldId:d,toggleFields:e,rules:f.settings.conditionals&&f.settings.conditionals.hasOwnProperty(d)?f.settings.conditionals[d]:null}));var b=c.data("_reasonsBuilder").getConditionals();if(b?(g[d]=b,c.addClass("reasonsHasConditionals")):c.removeClass("reasonsHasConditionals"),!c.data("_reasonsSettingsMenuItemInitialized")){var h=c.find(f.settings.fieldSettingsSelector),i=h.data("menubtn")||!1;if(!i)return;var j=i.menu.$container;j.find("ul").children(":first").clone(!0).prependTo(j.find("ul:first")).find("a:first").data("_reasonsField",c).attr("data-action","toggle-conditionals").text(Craft.t("Manage conditionals")).on("click",a.proxy(f.onFieldSettingsMenuItemClick,f)),c.data("_reasonsSettingsMenuItemInitialized",!0)}})}),0===Object.keys(g).length?this.$conditionalsInput.attr("value",""):this.$conditionalsInput.attr("value",JSON.stringify(g))},onFieldMouseDown:function(b){var c=this,d=function(b){a("body").off("mouseup",d),c.refresh()};a("body").on("mouseup",d)},onFieldSettingsMenuItemClick:function(b){b.preventDefault(),b.stopPropagation();var c=a(b.target),d=c.data("_reasonsField");if(!c.data("_reasonsModal")){var e=this,f=d.data("_reasonsBuilder"),g=a(this.templates.modal()),h=new Garnish.Modal(g,{resizable:!0,autoShow:!1,onShow:function(){e.refresh()},onHide:function(){e.refresh()}});f.get().appendTo(g.find(".body")),g.on("click",".close",function(a){h.hide()}),c.data("_reasonsModal",h)}c.data("_reasonsModal").show()},onFormSubmit:function(){this.refresh()}},{defaults:{id:null,conditionals:null,formSelector:"form:first",fieldSettingsSelector:"a.settings",fieldSelector:".fld-field",tabSelector:".fld-tabs .fld-tab",templates:{input:function(a){return'<input type="'+a.type+'" name="'+(a.name||"")+'" value="'+(a.value||"")+'" />'},modal:function(){return'<div class="modal elementselectormodal reasonsModal"><div class="body" /><div class="footer"><div class="buttons rightalign first"><div class="btn close submit">Done</div></div></div></div>'}}}})}(jQuery),function(a){"undefined"==typeof Reasons&&(Reasons={}),a.extend(Reasons,{defaults:{fldSelector:"#fieldlayoutform",conditionals:{}},init:function(){Reasons.settings=a.extend(Reasons.defaults,Reasons.settings||{});var b=Craft.path.split("/");if(b&&b[0]&&"settings"===b[0]&&"sections"===b[1]){if(!(Craft.path.indexOf("entrytypes/")>-1))return!1;var c=parseInt(Craft.path.substring(Craft.path.indexOf("entrytypes/")).split("/")[1])||"new",d=a(Reasons.settings.fldSelector);if(d.length>0){var e=this.getConditionalsDataByEntryTypeId(c);new Reasons.FieldLayoutConditionalDesigner(d,{id:e?e.id:null,conditionals:e?e.conditionals:null})}}else{var f=!1;switch(b[0]){case"entries":f=a("#entry-form")}if(!f||0===f.length)return!1;new Reasons.EditForm(f)}},getToggleFields:function(){return this.settings.toggleFields||[]},getToggleFieldById:function(a){a=parseInt(a);for(var b=Reasons.getToggleFields(),c=b.length,d=0;c>d;++d)if(parseInt(b[d].id)===a)return b[d];return!1},getConditionalsDataByEntryTypeId:function(a){for(var b,c=0;c<this.settings.conditionals.length;++c)if(b=this.settings.conditionals[c],b.typeId==a)return b;return!1},getEntryTypeIdsBySectionId:function(a){return this.settings.entryTypeIds&&this.settings.entryTypeIds.hasOwnProperty(a)?this.settings.entryTypeIds[a]:!1},getFieldIdByHandle:function(a){return this.settings.fieldIds&&this.settings.fieldIds.hasOwnProperty(a)?this.settings.fieldIds[a]:!1}})}(jQuery);